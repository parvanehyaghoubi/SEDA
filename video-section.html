<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/video-style.css">
    <title>Seda | Video-section</title>
</head>
<body>
    <!--==== Navbar Start ====-->
    <nav class="navbar sticky-top navbar-expand-lg py-6 py-lg-0">
        <div class="container px-4">
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <i class="fas fa-bars p-0"></i>
            </button>
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <button type="button" class="btn-close me-2" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel"><img src="#"
                            style="width: 90px; margin-right: 10px;"></h5>
                </div>
                <ul class="navbar-nav ms-lg-auto p-4 p-lg-0"  dir="rtl">
                    <li class="nav-item px-3 px-lg-1 py-lg-3">
                        <a class="nav-link" id="nav-home" href="#Home">خانه</a>
                    </li>
                    <li class="nav-item px-3 px-lg-1 py-lg-3">
                        <a class="nav-link" id="nav-play" href="#video-section">ویدیو ها</a>
                    </li>
                    <li class="nav-item px-3 px-lg-1 py-lg-3 dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">ابزار اضطراری</a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" id="nav-library-link" href="#video-library">لیست ویدیو ها</a>
                            </li>
                            <li> <a class="dropdown-item" id="nav-add" class="add-link" href="javascript:void(0)">افزودن ویدیو</a></li>
                            <li><a class="dropdown-item" href="#guidance">رهنمایی</a></li>
                            <li><a class="dropdown-item" href="#Chat-box">چت باکس</a></li>
                            <li><a class="dropdown-item" href="#Q&A">سوال و جواب</a></li>
                        </ul>
                    <li class="nav-item px-3 px-lg-1 py-lg-3">
                        <a class="nav-link" href="#Contact">ارتباط با ما</a>
                    </li>
                </ul>
            </div>
            <a class="navbar-brand" href="#"><img src="#" style="width: 70px;"></a>
        </div>
    </nav>
    <!--==== Navbar End ====-->

    <!--==== Main Container Start ====-->
    <div class="main-container">
    <!-- PLAY SECTION START -->
        <section id="playSection" class="section play-section" aria-label="Play section">
            <div class="search-wrap">
                <div class="search" role="search">
                    <!-- search icon -->
                    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M21 21l-4.35-4.35" stroke="#02645f" stroke-width="1.6" stroke-linecap="round"
                            stroke-linejoin="round" />
                        <circle cx="11" cy="11" r="6" stroke="#02645f" stroke-width="1.6" />
                    </svg>
                    <input id="searchInput" placeholder="جستجوی ویدیوها (عنوان یا توضیحات)..."
                        aria-label="Search videos">
                </div>
            </div>

            <div class="player-panel">
                <div id="playerWrapper" class="player-wrapper" aria-live="polite">
                    <div id="playerEmpty" class="player-empty">جستجو کنید یا روی یک ویدیو کلیک کنید تا اینجا پخش شود.</div>
                </div>

                <div class="video-info text-end">
                    <div class="title" id="playerTitle"></div>
                    <div class="meta" id="playerMeta"></div>
                    <div class="desc" id="playerDesc"></div>
                </div>
            </div>
            <div class="suggested-section" style="width:100%; max-width:1100px;">
                <h4 style="color:#004a49; margin:14px 0 8px">پیشنهاد شده</h4>
                <div id="suggestedRow" class="suggested-row"></div>
            </div>

            <!--  search results -->
            <div id="resultsGrid" class="results-grid" aria-live="polite" style="margin-top:20px"></div>
        </section>

    <!-- PLAY SECTION END -->
    </div>
    <!--==== Main Container End ====-->

    <script>
        let videoLibrary = [
            { id: 'v1', title: "ساخت رمزهای عبور قوی و به‌یادماندنی", duration: "۳:۲۳", description: "این ویدیو نکاتی کاربردی برای ایجاد رمزهایی ارائه می‌دهد که هم قوی هستند و هم به آسانی فراموش نمی‌شوند.", thumbnail: "https://i.pinimg.com/736x/ba/7d/02/ba7d02b3f0fa3005ca5ab46fd28cffeb.jpg", embed: "https://www.youtube.com/embed/3f0u-vw58A0?si=P_g01C6daYM-pcnB" },
            { id: 'v2', title: "روش‌های ایمن‌سازی حساب جیمیل", duration: "۴:۳۰", description: "در این آموزش، گام‌به‌گام با روش‌های ساده و مؤثر برای افزایش امنیت حساب جیمیل خود آشنا می‌شوید.", thumbnail: "https://i.pinimg.com/1200x/38/75/2c/38752c0b7dbce2344ae3ad72a1838045.jpg", embed: "https://www.youtube.com/embed/wOU6e6NNlvY?si=iRozFmU7YQ3ZLyul" },
            { id: 'v3', title: "مبانی امنیت سایبری", duration: "۱۵:۰۲", description: "این ویدیو مفاهیم اصلی امنیت سایبری را معرفی می‌کند و نشان می‌دهد چگونه می‌توان از تهدیدات آنلاین محافظت کرد.", thumbnail: "https://img.youtube.com/vi/5MMoxyK1Y9o/maxresdefault.jpg", embed: "https://www.youtube.com/embed/FomJTL4gjn0?si=OXqdS8gREC1r4HYC" },
            { id: 'v4', title: "جلوگیری از اشتباهات متداول در رمز عبور", duration: "۶:۴۵", description: "در این ویدیو می‌آموزید چگونه از اشتباهات رایج ..هنگام ساخت یا استفاده از رمز عبور جلوگیری کنید تا امنیت حساب‌های شما افزایش یابد.", thumbnail: "https://i.pinimg.com/736x/45/05/46/45054604b7873b602df111c3af7a53ed.jpg", embed: "https://www.youtube.com/embed/SuIyUsmp5dw?si=BskKB4evWG5jGiw2" },
            { id: 'v5', title: "Recognizing Phishing Attempts", duration: "۹:۰۵", description: "How to spot phishing emails and fake login pages.", thumbnail: "https://i.pinimg.com/736x/37/b6/49/37b6493cd794652f3cc5a151226456ab.jpg", embed: "https://www.youtube.com/embed/R-JUOpCgTZc?si=gxsyYxSF7LcJqs1d" }
        ];

        /* ---------- DOM ---------- */
        const searchInput = document.getElementById('searchInput');
        const resultsGrid = document.getElementById('resultsGrid');
        const playerWrapper = document.getElementById('playerWrapper');
        const playerTitle = document.getElementById('playerTitle');
        const playerMeta = document.getElementById('playerMeta');
        const playerDesc = document.getElementById('playerDesc');
        const playerEmpty = document.getElementById('playerEmpty');
        const suggestedRow = document.getElementById('suggestedRow');
        const libraryGrid = document.getElementById('libraryGrid');
        const seeMoreBtn = document.getElementById('seeMoreBtn');

        const navPlay = document.getElementById('nav-play');
        const navLibrary = document.getElementById('nav-library-link');
        const navHome = document.getElementById('nav-home');
        const navAdd = document.getElementById('nav-add');

        const addVideoSection = document.getElementById('addVideoSection');
        const inputThumb = document.getElementById('inputThumb');
        const inputTitle = document.getElementById('inputTitle');
        const inputDuration = document.getElementById('inputDuration');
        const inputURL = document.getElementById('inputURL');
        const inputDesc = document.getElementById('inputDesc');
        const thumbPreview = document.getElementById('thumbPreview');
        const saveVideoBtn = document.getElementById('saveVideoBtn');

        /* ---------- RENDER helpers ---------- */
        function escapeHTML(str) { return String(str).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m])); }
        function shortText(s, n = 100) { if (!s) return ''; return s.length > n ? s.slice(0, n - 1) + '…' : s; }

        /* create card (block layout: img on top, content under) */
        function makeCard(video) {
            const div = document.createElement('div'); div.className = 'card';
            div.innerHTML = `
    <img src="${escapeHTML(video.thumbnail)}" alt="${escapeHTML(video.title)}">
    <div class="info">
        <h3>${escapeHTML(video.title)}</h3>
        <div class="dur">${escapeHTML(video.duration)}</div>
        <p>${escapeHTML(shortText(video.description, 120))}</p>
    </div>
`;
            div.addEventListener('click', () => playVideo(video));
            return div;
        }
        function makeSuggestCard(video) {
            const div = document.createElement('div'); div.className = 'suggest-card';
            div.innerHTML = `<img src="${escapeHTML(video.thumbnail)}"><div class="smeta"><h4>${escapeHTML(video.title)}</h4><p>${escapeHTML(video.duration)}</p></div>`;
            div.addEventListener('click', () => playVideo(video));
            return div;
        }

        /* ---------- initial render ---------- */
        function renderSuggested() {
            suggestedRow.innerHTML = '';
            videoLibrary.slice(0, 4).forEach(v => suggestedRow.appendChild(makeSuggestCard(v)));
        }
        function renderLibrary(showAll = false) {
            libraryGrid.innerHTML = '';
            const items = showAll ? videoLibrary : videoLibrary.slice(0, 4);
            items.forEach(v => libraryGrid.appendChild(makeCard(v)));
            seeMoreBtn.textContent = showAll ? 'Show less' : 'See more';
            seeMoreBtn.dataset.showing = showAll ? 'all' : 'partial';
        }
        renderSuggested();
        renderLibrary(false);

        /* ---------- SEARCH ---------- */
        /* normalize words: split and trim */
        function normalizeWords(s) {
            return s.toLowerCase().split(/\s+/).map(x => x.trim()).filter(Boolean);
        }
        /* search: ensure every query word appears in title or description */
        function searchVideos(query) {
            if (!query) return videoLibrary.slice();
            const qWords = normalizeWords(query);
            return videoLibrary.filter(v => {
                const combined = (v.title + ' ' + v.description).toLowerCase();
                return qWords.every(qw => combined.includes(qw));
            });
        }

        function showResults(list) {
            resultsGrid.innerHTML = '';
            if (list.length === 0) {
                // show "no results" inside player
                playerWrapper.classList.remove('expanded');
                playerWrapper.innerHTML = '<div class="player-empty">No results found. Try a different search.</div>';
                playerTitle.textContent = ''; playerMeta.textContent = ''; playerDesc.textContent = '';
            } else {
                // render cards
                list.forEach(v => resultsGrid.appendChild(makeCard(v)));
                // do not auto-play; keep player as is
            }
        }

        /* input listener */
        searchInput.addEventListener('input', (e) => {
            const q = e.target.value.trim();
            const found = searchVideos(q);
            showResults(found);
        });

        /* ---------- PLAY VIDEO ---------- */
        function playVideo(video) {
            // expand player and insert iframe
            playerWrapper.classList.add('expanded');
            playerWrapper.innerHTML = ''; // clear
            const iframe = document.createElement('iframe');
            iframe.src = `${video.embed}?autoplay=1&modestbranding=1&rel=0&controls=1`;
            iframe.allow = "autoplay; encrypted-media; picture-in-picture";
            iframe.setAttribute('loading', 'lazy');
            iframe.addEventListener('load', () => iframe.classList.add('loaded'));
            playerWrapper.appendChild(iframe);

            // update info
            playerTitle.textContent = video.title;
            playerMeta.textContent = 'مدت' + ' ' + video.duration ;
            playerDesc.textContent = video.description;

            // no search action required — update suggested (move played video to front)
            const idx = videoLibrary.findIndex(v => v.id === video.id);
            if (idx > 0) { // move to front
                const [picked] = videoLibrary.splice(idx, 1);
                videoLibrary.unshift(picked);
                renderSuggested();
                renderLibrary(seeMoreBtn.dataset.showing === 'all');
            }
        }
        playerWrapper.innerHTML = '<div id="playerEmpty" class="player-empty">Search or click a video to play it here.</div>';
        searchInput.value = '';
        resultsGrid.innerHTML = ''; // empty initially

        /* expose for debugging (optional) */
        window._vp = { videoLibrary, playVideo, searchVideos };
    </script>

    <!-- BOOTSTRAP SCRIPT-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
</body>
</html>
